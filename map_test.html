<html>

<head>
	<script src="js/easeljs-0.5.0.min.js" type="text/javascript"></script>
	<script type="text/javascript">
		var game = {};
	</script>
	<script src="js/static-entity.js" type="text/javascript"></script>
	<script src="js/fart.js" type="text/javascript"></script>
	<style type="text/css">
		#content {
			user-select: none;
			background-color:#000000;
			width: 800px;
			height: 600px;
		}
	</style>
</head>
<body onload="init();">

	<div id="content">
		<canvas id="gameCanvas" width="800" height="600">
		</canvas>
	</div>

<script type="text/javascript">
	var gameController = {
		collision: [
				"#########################",
				"#          Tp          L#",
				"#R                     U#",
				"#  PPPPPPPPFFPPPPPPPP   #",
				"#     O                F#",
				"#  PPPPPPPP  PPPPPPPP   #",
				"#       O        O      #",
				"#  PPPPPPPP  PPPPPPPP   #",
				"#                       #",
				"#  PPPPPPPP  PPPPPPPP   #",
				"#U         X            #",
				"###########DD############"
			],
		canvas: null,
		stage: null,
		objects: [],
		objectsToDelete: []
	};
	
	function addEntity(newEntity) {
		gameController.stage.addChild(newEntity);
	};
	
	function removeEntity(newEntity) {
		gameController.objectsToDelete.push(newEntity);
	};
	
	gameController.init = function() {
		this.canvas = document.getElementById("gameCanvas")
		this.stage = new createjs.Stage(this.canvas);
		
		for(var i = 0; i < this.collision.length; i++) {
			var row = this.collision[i];
			
			for (var j = 0; j < row.length; j++) {
				var newObj = null;
				
				switch(row[j]) {
					case "#":
						newObj = new game.StaticEntity();
						break;
					case "T":
						newObj = new game.StaticEntity();
						break;
					case "p":
						newObj = new game.StaticEntity();
						break;
					case "P":
						newObj = new game.StaticEntity();
						break;
					case "O":
						newObj = new game.StaticEntity();
						break;
					case "U":
						newObj = new game.StaticEntity();
						break;
					case "D":
						newObj = new game.StaticEntity();
						break;
					case "L":
						newObj = new game.StaticEntity();
						break;
					case "R":
						newObj = new game.StaticEntity();
						break;
					case "X":
						newObj = new game.StaticEntity();
						break;
					case "d":
						newObj = new game.StaticEntity();
						break;
					case "F":
						newObj = new game.StaticEntity();
						break;
				}
				
				if (newObj != null) {
					newObj.x = j * 32;
					newObj.y = i * 32;
				
					addEntity(newObj);
				}
			}
			
			var bigOldFart = new game.Fart();
			bigOldFart.vX = 50;
			bigOldFart.x = 0;
			bigOldFart.y = 400;
			
			addEntity(bigOldFart);
		}
	};
	
	gameController.tick = function() {
		for(var i = 0; i < this.stage.children.length; i++) {
			if (this.stage.children[i].tick) {
				this.stage.children[i].tick();
			}
		}
		this.stage.update();
		
		for(var i = this.objectsToDelete.length - 1; i >= 0; i--) {
			this.stage.removeChild(this.objectsToDelete[i]);
		}
		
		this.objectsToDelete = [];
	};
	
	function init() {
		gameController.init();
		
		//start game timer
		createjs.Ticker.addListener(gameController);
		
		gameController.stage.update();
	}
</script>
</body>
</html>